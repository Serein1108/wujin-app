<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç‰©å°½ Asset Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'media' }</script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        input, select { outline: none; }
        i { vertical-align: middle; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-950 dark:text-gray-100 transition-colors duration-300">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const BETA_CODE = "1108"; 
        const PRESETS = { indigo: { name: 'é»˜è®¤ç´«', hex: '#4f46e5' }, zinc: { name: 'æç®€é»‘', hex: '#27272a' }, orange: { name: 'æ´»åŠ›æ©™', hex: '#f97316' }, emerald:{ name: 'æ¸…æ–°ç»¿', hex: '#059669' }, rose: { name: 'çŒ›ç”·ç²‰', hex: '#f43f5e' }, sky: { name: 'å¤©ç©ºè“', hex: '#0ea5e9' } };
        const AVATAR_SHAPES = { full: { name: 'åœ†å½¢', class: 'rounded-full' }, ios: { name: 'åœ†è§’', class: 'rounded-[1.5rem]' }, leaf: { name: 'å¶å­', class: 'rounded-tl-3xl rounded-br-3xl rounded-tr-md rounded-bl-md' }, square: { name: 'æ–¹å½¢', class: 'rounded-lg' }, custom: { name: 'è‡ªå®šä¹‰', class: '' } };

        const Icon = ({ name, weight, className, style }) => <i className={`ph${weight==='fill'?'-fill':''} ph-${name} ${className||''}`} style={style}></i>;
        const compressImage = (f, cb) => { if(!f)return; const r=new FileReader(); r.readAsDataURL(f); r.onload=(e)=>{ const i=new Image(); i.src=e.target.result; i.onload=()=>{ const c=document.createElement('canvas'); const s=400/i.width; c.width=400; c.height=i.height*s; c.getContext('2d').drawImage(i,0,0,400,c.height); cb(c.toDataURL('image/jpeg',0.7)); } } };
        const getGreeting = () => { const h=new Date().getHours(); return h<6?'å¤œæ·±äº†':h<9?'æ—©ä¸Šå¥½':h<12?'ä¸Šåˆå¥½':h<14?'ä¸­åˆå¥½':h<18?'ä¸‹åˆå¥½':'æ™šä¸Šå¥½'; };
        const calculateAssetStats = (a) => {
            const p=new Date(a.purchaseDate); let e=new Date(); if(a.status==='å·²å›è¡€'&&a.soldDate)e=new Date(a.soldDate);
            let d=Math.floor((e-p)/86400000); d=Math.max(1,d);
            let n=parseFloat(a.originalPrice)||0; if(a.status==='å·²å›è¡€'&&a.sellPrice)n-=parseFloat(a.sellPrice)||0; if(a.status==='ç”Ÿé’±ä¸­'&&a.rentIncome)n-=parseFloat(a.rentIncome)||0;
            const dc=n/d; 
            let de=null,ie=false,ies=false; if(a.expirationDate){ const diff=Math.ceil((new Date(a.expirationDate)-new Date())/86400000); if(diff<0)ie=true;else if(diff<=30)ies=true; de=diff; }
            let io=false,od=0; if(a.status==='ç”Ÿé’±ä¸­'&&a.returnDate){ const rd=new Date(a.returnDate); const t=new Date(); t.setHours(0,0,0,0); rd.setHours(0,0,0,0); if(t>rd){ io=true; od=Math.floor((t-rd)/86400000); } }
            return { daysUsed:d, dailyCost:dc.toFixed(2), netCost:n.toFixed(2), isProfitable:n<0, isFinalized:a.status==='å·²å›è¡€', daysToExpire:de, isExpired:ie, isExpiringSoon:ies, isOverdue:io, overdueDays:od };
        };

        const App = () => {
            const [locked, setLocked] = useState(true);
            useEffect(() => { if(localStorage.getItem('app-unlocked')==='true') setLocked(false); }, []);
            if(locked) return (
                <div className="min-h-screen bg-gray-900 flex flex-col items-center justify-center p-6 text-white">
                    <div className="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center mb-6 shadow-xl"><Icon name="lock-key" className="text-3xl"/></div>
                    <h1 className="text-2xl font-bold mb-2">ç‰©å°½ Internal</h1>
                    <input type="password" onChange={e=>{if(e.target.value===BETA_CODE){setLocked(false);localStorage.setItem('app-unlocked','true')}}} placeholder="è¾“å…¥å£ä»¤" className="w-full max-w-xs bg-gray-800 border border-gray-700 rounded-xl p-4 text-center tracking-widest outline-none focus:border-indigo-500"/>
                    <p className="fixed bottom-8 text-gray-600 text-xs">v14.0 Universal</p>
                </div>
            );
            return <MainApp />;
        };

        const MainApp = () => {
            const [assets, setAssets] = useState([]);
            const [tab, setTab] = useState('å…¨éƒ¨');
            const [search, setSearch] = useState('');
            const [sort, setSort] = useState('date');
            const [modal, setModal] = useState(false);
            const [settings, setSettings] = useState(false);
            const [theme, setTheme] = useState(PRESETS.indigo.hex);
            const [user, setUser] = useState({ name: 'æˆ‘çš„', avatar: '', shape: 'full', customCorners: [50,50,50,50] });
            const [privacy, setPrivacy] = useState(false);
            const [newAsset, setNewAsset] = useState({ name: '', originalPrice: '', purchaseDate: new Date().toISOString().split('T')[0], status: 'è‡ªç”¨ä¸­', category: 'ç”µå­äº§å“', sellPrice: '', soldDate: '', rentIncome: '', customImage: '', location: '', expirationDate: '', platformName: '', tenantName: '', returnDate: '' });
            const [editId, setEditId] = useState(null);
            const fileRef = useRef(null);

            useEffect(() => {
                const d=localStorage.getItem('my-assets'); if(d) setAssets(JSON.parse(d));
                const t=localStorage.getItem('app-theme-color'); if(t) setTheme(PRESETS[t]?PRESETS[t].hex:t);
                const p=localStorage.getItem('app-user-profile'); if(p) setUser(JSON.parse(p));
                if(localStorage.getItem('app-privacy-mode')==='true') setPrivacy(true);
            }, []);
            useEffect(() => localStorage.setItem('my-assets', JSON.stringify(assets)), [assets]);
            useEffect(() => localStorage.setItem('app-theme-color', theme), [theme]);
            useEffect(() => localStorage.setItem('app-user-profile', JSON.stringify(user)), [user]);
            useEffect(() => localStorage.setItem('app-privacy-mode', privacy), [privacy]);

            const T = { bg:{backgroundColor:theme}, text:{color:theme}, border:{borderColor:theme} };
            const getAvatarStyle = () => user.shape==='custom' ? {borderRadius:`${user.customCorners[0]}% ${user.customCorners[1]}% ${user.customCorners[2]}% ${user.customCorners[3]}%`} : {};
            const getAvatarClass = () => user.shape==='custom' ? '' : AVATAR_SHAPES[user.shape||'full'].class;
            const displayMoney = (v) => privacy ? '****' : `Â¥${v}`;

            const summary = useMemo(() => {
                const c = assets.filter(a => a.status !== 'å·²å›è¡€');
                const t = c.reduce((s, a) => s + (Number(a.originalPrice) || 0), 0);
                const d = assets.reduce((s, a) => s + (parseFloat(calculateAssetStats(a).dailyCost) || 0), 0);
                return { total: t.toFixed(0), daily: d.toFixed(2) };
            }, [assets]);

            const filtered = useMemo(() => {
                let l = assets;
                if(tab!=='å…¨éƒ¨') l = ['è‡ªç”¨ä¸­','åƒç°ä¸­','å·²å›è¡€','ç”Ÿé’±ä¸­'].includes(tab) ? l.filter(a=>a.status===tab) : l.filter(a=>a.category===tab);
                if(search) l = l.filter(a => JSON.stringify(a).toLowerCase().includes(search.toLowerCase()));
                return l.sort((a, b) => sort==='price_high'?b.originalPrice-a.originalPrice : sort==='price_low'?a.originalPrice-b.originalPrice : new Date(b.purchaseDate)-new Date(a.purchaseDate));
            }, [assets, tab, search, sort]);

            const cats = ['å…¨éƒ¨', 'è‡ªç”¨ä¸­', 'ç”Ÿé’±ä¸­', 'åƒç°ä¸­', 'å·²å›è¡€', ...new Set(assets.map(a => a.category).filter(Boolean))];

            const save = () => {
                if(!newAsset.name || !newAsset.originalPrice) return alert('è¯·å¡«å†™åç§°å’Œä»·æ ¼');
                if(editId) setAssets(p => p.map(a => a.id === editId ? {...newAsset, id: editId} : a));
                else setAssets(p => [{...newAsset, id: Date.now().toString()}, ...p]);
                setModal(false);
            };
            
            const handleImportFile = (e) => { const f=e.target.files[0]; if(!f)return; const r=new FileReader(); r.onload=(ev)=>{ try{const d=JSON.parse(ev.target.result);if(Array.isArray(d)&&confirm('ç¡®è®¤å¯¼å…¥ï¼Ÿ')){setAssets(d);setSettings(false);}}catch{alert('æ–‡ä»¶é”™è¯¯');}}; r.readAsText(f); e.target.value=''; };

            return (
                <div className="min-h-screen pb-24 font-sans transition-colors duration-300">
                    <header className="bg-white dark:bg-gray-900 px-5 pt-10 pb-4 rounded-b-3xl shadow-sm sticky top-0 z-20">
                        <div className="flex justify-between items-start mb-6">
                            <div className="flex items-center"><div><h1 className="text-3xl font-black dark:text-white">ç‰©å°½</h1><p className="text-xs text-gray-400 mt-1">{getGreeting()}ï¼Œ{user.name}</p></div></div>
                            <button onClick={()=>setSettings(true)} className={`w-12 h-12 bg-gray-200 border-2 border-white shadow overflow-hidden ${getAvatarClass()}`} style={getAvatarStyle()}>{user.avatar?<img src={user.avatar} className="w-full h-full object-cover"/>:<div className="w-full h-full flex items-center justify-center text-gray-400"><Icon name="user" className="text-xl"/></div>}</button>
                        </div>
                        <div className="grid grid-cols-2 gap-3 relative">
                            <button onClick={()=>setPrivacy(!privacy)} className="absolute -top-8 right-0 text-gray-400"><Icon name={privacy?"eye-slash":"eye"} className="text-xl"/></button>
                            <div className="p-4 rounded-2xl text-white shadow-lg" style={{...T.bg}}><p className="text-xs opacity-70">æŒæœ‰æ€»å€¼</p><p className="text-2xl font-bold">{displayMoney(summary.total)}</p></div>
                            <div className="bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-4 rounded-2xl"><p className="text-xs text-gray-400">æ¯æ—¥æ¶ˆè€—</p><p className="text-2xl font-bold dark:text-white">{displayMoney(summary.daily)}</p></div>
                        </div>
                    </header>

                    <div className="sticky top-[15rem] z-10 bg-[#F5F7FA]/95 dark:bg-gray-950/95 pt-4 pb-2 space-y-3">
                        <div className="flex overflow-x-auto space-x-2 px-5 no-scrollbar">{cats.map(c=><button key={c} onClick={()=>setTab(c)} className={`px-4 py-1.5 text-xs font-bold rounded-full whitespace-nowrap transition-all ${tab===c ? 'text-white shadow-md' : 'bg-white dark:bg-gray-800 text-gray-500 border border-gray-200 dark:border-gray-700'}`} style={tab===c ? T.bg : {}}>{c}</button>)}</div>
                        <div className="px-5 relative"><Icon name="magnifying-glass" className="absolute left-8 top-3 text-gray-400"/><input value={search} onChange={e=>setSearch(e.target.value)} placeholder="æœç´¢..." className="w-full bg-white dark:bg-gray-800 dark:text-white pl-10 pr-4 py-2 rounded-xl text-sm border border-gray-200 dark:border-gray-700 outline-none focus:ring-2" style={{'--tw-ring-color': theme}}/></div>
                    </div>

                    <div className="px-5 mt-2 space-y-3">
                        {filtered.map(a => {
                            const s = calculateAssetStats(a);
                            const img = a.customImage || `https://image.pollinations.ai/prompt/${encodeURIComponent(a.name)}?width=200&height=200&nologo=true`;
                            let bc; switch(a.status){ case 'è‡ªç”¨ä¸­': bc='border-green-500'; break; case 'ç”Ÿé’±ä¸­': bc='border-blue-500'; break; case 'å·²å›è¡€': bc='border-red-400'; break; default: bc='border-yellow-500'; }
                            return (
                                <div key={a.id} onClick={()=>{setEditId(a.id);setNewAsset({...a});setModal(true)}} className={`cursor-pointer bg-white dark:bg-gray-800 p-3 rounded-xl shadow-sm border-l-4 ${bc} flex gap-3 hover:shadow-md transition-all`}>
                                    <div className="w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-lg overflow-hidden flex-shrink-0"><img src={img} className="w-full h-full object-cover" onError={e=>{e.target.src='https://placehold.co/200x200?text=No+Img'}}/></div>
                                    <div className="flex-1 flex flex-col justify-between">
                                        <div className="flex justify-between">
                                            <div><h3 className="font-bold dark:text-white leading-tight">{a.name}</h3><div className="flex flex-wrap items-center text-xs text-gray-500 dark:text-gray-400 mt-1 gap-2"><span>ğŸ“… {s.daysUsed}å¤©</span>{a.location&&<span className="flex items-center"><Icon name="map-pin" className="mr-1"/>{a.location}</span>}</div></div>
                                            <span className="text-[10px] px-2 py-0.5 h-fit rounded-full bg-gray-100 dark:bg-gray-700 text-gray-500">{a.status}</span>
                                        </div>
                                        {s.isOverdue && <div className="bg-red-50 text-red-600 text-xs p-1 rounded mt-1">ğŸ”” é€¾æœŸ {s.overdueDays} å¤©</div>}
                                        <div className="flex justify-between items-end mt-1"><p className="text-xs text-gray-400">åŸ {displayMoney(a.originalPrice)}</p><div className="text-right"><span className="text-lg font-bold" style={{color: s.isFinalized?'#9ca3af':s.isProfitable?'#16a34a':theme}}>{privacy?'****':(s.isProfitable?'+':'')+'Â¥'+Math.abs(s.dailyCost)}</span><span className="text-xs text-gray-400">/å¤©</span></div></div>
                                    </div>
                                </div>
                            )
                        })}
                        {filtered.length===0 && <div className="text-center text-gray-400 py-10">æš‚æ— æ•°æ®</div>}
                    </div>

                    <div className="fixed bottom-6 right-6 z-40"><button onClick={()=>{setEditId(null);setNewAsset({name:'',originalPrice:'',purchaseDate:new Date().toISOString().split('T')[0],status:'è‡ªç”¨ä¸­',category:'ç”µå­äº§å“',sellPrice:'',soldDate:'',rentIncome:'',customImage:'',location:'',expirationDate:'',platformName:'',tenantName:'',returnDate:''});setModal(true)}} className="text-white w-14 h-14 rounded-full shadow-xl flex items-center justify-center text-3xl pb-1 active:scale-95 transition-transform" style={T.bg}>+</button></div>

                    {(modal || settings) && <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
                        <div className="bg-white dark:bg-gray-800 w-full max-w-sm rounded-2xl p-5 shadow-2xl max-h-[90vh] overflow-y-auto">
                            <div className="flex justify-between mb-4"><h2 className="font-bold text-lg dark:text-white">{settings?'è®¾ç½®':'ç¼–è¾‘'}</h2><button onClick={()=>{setModal(false);setSettings(false)}}><Icon name="x" className="text-xl text-gray-400"/></button></div>
                            {settings ? (
                                <div className="space-y-4">
                                    <div className="bg-gray-50 dark:bg-gray-700 p-3 rounded-xl flex items-center gap-3"><label className={`w-12 h-12 bg-gray-200 overflow-hidden relative cursor-pointer ${getAvatarClass()}`} style={getAvatarStyle()}><img src={user.avatar} className="w-full h-full object-cover"/><input type="file" className="hidden" onChange={e=>compressImage(e.target.files[0],d=>{setUser(p=>({...p,avatar:d}));alert('âœ… å¤´åƒæ›´æ–°')})}/></label><div className="flex-1"><input value={user.name} onChange={e=>setUser(p=>({...p,name:e.target.value}))} className="bg-transparent font-bold border-b border-gray-300 w-24 text-gray-800 dark:text-white"/><p className="text-xs text-gray-400">ç‚¹å‡»å¤´åƒ/åå­—ä¿®æ”¹</p></div></div>
                                    <div className="grid grid-cols-6 gap-2">{Object.entries(PRESETS).map(([k,p])=><button key={k} onClick={()=>setTheme(p.hex)} className="w-8 h-8 rounded-full border border-gray-200" style={{background:p.hex}}>{theme===p.hex&&<Icon name="check" className="text-white"/>}</button>)}</div>
                                    <div className="flex gap-2"><button onClick={()=>{const b=new Blob([JSON.stringify(assets)],{type:"application/json"});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download='backup.json';a.click();}} className="flex-1 py-2 bg-gray-100 dark:bg-gray-700 rounded text-xs dark:text-white">å¯¼å‡º</button><button onClick={()=>fileRef.current.click()} className="flex-1 py-2 bg-gray-100 dark:bg-gray-700 rounded text-xs dark:text-white">å¯¼å…¥</button><input type="file" ref={fileRef} onChange={handleImportFile} className="hidden"/></div>
                                    <button onClick={handleResetData} className="w-full py-2 text-red-500 text-xs">æ¸…ç©ºæ•°æ®</button>
                                    <p className="text-center text-[10px] text-gray-300 mt-2">Designed by {user.name}</p>
                                </div>
                            ) : (
                                <div className="space-y-3">
                                    <div className="flex gap-2"><div className="w-20 h-20 bg-gray-100 rounded-lg overflow-hidden relative"><img src={newAsset.customImage||`https://image.pollinations.ai/prompt/${newAsset.name}?nologo=true`} className="w-full h-full object-cover"/><input type="file" className="absolute inset-0 opacity-0" onChange={e=>compressImage(e.target.files[0],d=>{setNewAsset(p=>({...p,customImage:d}));alert('âœ… å›¾ç‰‡æ·»åŠ ')})}/></div><div className="flex-1"><input value={newAsset.name} onChange={e=>setNewAsset(p=>({...p,name:e.target.value}))} placeholder="åç§°" className="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white mb-2"/><div className="flex gap-2"><input type="number" value={newAsset.originalPrice} onChange={e=>setNewAsset(p=>({...p,originalPrice:e.target.value}))} placeholder="ä»·æ ¼" className="w-1/2 p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"/><input type="date" value={newAsset.purchaseDate} onChange={e=>setNewAsset(p=>({...p,purchaseDate:e.target.value}))} className="w-1/2 p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"/></div></div></div>
                                    <div className="flex gap-2"><select value={newAsset.status} onChange={e=>setNewAsset(p=>({...p,status:e.target.value}))} className="w-1/2 p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"><option>è‡ªç”¨ä¸­</option><option>å·²å›è¡€</option><option>ç”Ÿé’±ä¸­</option><option>åƒç°ä¸­</option></select><input value={newAsset.category} onChange={e=>setNewAsset(p=>({...p,category:e.target.value}))} placeholder="åˆ†ç±»" className="w-1/2 p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"/></div>
                                    {newAsset.status === 'å·²å›è¡€' && <input type="number" placeholder="å›è¡€é‡‘é¢" value={newAsset.sellPrice} onChange={e=>setNewAsset(p=>({...p,sellPrice:e.target.value}))} className="w-full p-2 border border-red-200 rounded"/>}
                                    <div className="flex gap-2 mt-4"><button onClick={handleDelete} className="flex-1 py-3 text-red-500">åˆ é™¤</button><button onClick={save} className="flex-1 py-3 text-white rounded-xl shadow-lg" style={T.bg}>ä¿å­˜</button></div>
                                </div>
                            )}
                        </div>
                    </div>}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
